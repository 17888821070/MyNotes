# 数据链路层

## 1. 数据链路层的主要功能

* 封装成帧
* 透明传输
* 差错检测

## 2. 三个基本问题

### 2.1 封装成帧

* 数据链路层将网络层的IP数据报加上首部和尾部，形成帧

* 使用控制字符SOH（01）标志开始，使用EOT（04）标记结束，SOH和EOT是个名字，不是S、O、H和E、O、T字符

  ![](imgs\1598317574798.png)

### 2.2 透明传输

* 如果传输数据是文本数据，则不可能在文本中出现与SOH和EOT的二进制码冲突的情况，就是透明传输

* 如果传输数据是图像等，可能出现于SOH和EOT冲突的二进制码，发送端则在冲突的码前加上转义表示符ESC，十六进制1B （00011011），跟ESC冲突的字符也一样加上转义字符。接收端的数据链路层在把数据送往网络层之前删除这个**插入**的转义字符。

  ![1598317654285](imgs\1598317654285.png)

### 2.3 差错检测

* 检测比特差错（传输的数据01出现错误），不保证帧失序、重复、丢失问题
  * 使用CRC循环冗余检验技术
  * 发送方：在要传输的帧数据后上加n个0组成被除数，双方约定一个n+1位的除数，被除数除除数得到余数，原帧数据+余数就是真正被传输的数据
  * 接收方：用接收到的数据除以约定的除数，如果结果为0，则表示数据正确，接收；否则，丢弃

![1598317800590](imgs\1598317800590.png)

## 3. MAC寻址

数据链路层使用MAC寻址

* MAC是计算机网卡的物理地址（硬件地址），6个字节，唯一确定的物理地址

* MTU最大传输单元：一个MAC帧中数据部分的最大长度，超过此长度就要进行分组

* MAC帧

  ![1598319607058](imgs\1598319607058.png)

  * 以便把收到的MAC帧的数据上交给上一层的这个协议。例如，当类型字段的值是0x0800时，就表示上层使用的是IP数据报。若类型字段的值为0x8137，则表示该帧是由Novell IPX发过来的。第四个字段是数据字段，其长度在46到1 500字节之间（46字节是这样得出的：最小长度64字节减去18字节的首部和尾部就得出数据字段的最小长度）。最后一个字段是4字节的帧检验序列FCS（使用CRC检验）。当传输媒体的误码率为1×10-8时，MAC子层可使未检测到的差错小于1×10-14。

* 数据在网络中的传输过程中，MAC帧每经过一个节点，就会更换一个目标MAC，IP数据报则一直是同一个目标IP、

### 4. 其他问题

#### 4.1 如何判断MAC帧发送结束？

* MAC帧不是连续发送的，在两个帧之间会有间隔，此间格内没有电压的变化（当发送方把一个以太网帧发送完毕后，就不再发送其他码元了（既不发送1，也不发送0）。因此，发送方网络适配器的接口上的电压也就不再变化了。这样，接收方就可以很容易地找到以太网帧的结束位置。在这个位置往前数4字节（FCS字段长度是4字节），就能确定数据字段的结束位置。）

#### 4.2 以太网中的MAC帧没有帧定界符，为什么点对点通信中的PPP帧需要帧定界符？

* 简单的说就是因为MAC帧不是连续发送，两个帧当中有间隔，当信道当中没有电压的改变接收方就知道发送方的帧发送结束了

* ppp协议当中帧是可以连续发送的，因此需要帧结束的标志字段