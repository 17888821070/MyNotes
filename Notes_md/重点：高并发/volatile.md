# volatile

## 原理

* 汇编指令码

  > 生成的汇编代码，加入volatile关键字时，会多出一个lock前缀指令
  > 　　lock前缀指令实际上相当于一个内存屏障（也成内存栅栏），内存屏障会提供3个功能：
  >
  > 　　1）它确保指令重排序时不会把其后面的指令排到内存屏障之前的位置，也不会把前面的指令排到内存屏障的后面；即在执行到内存屏障这句指令时，在它前面的操作已经全部完成；
  >
  > 　　2）它会强制将对缓存的修改操作立即写入主存；
  >
  > 　　3）如果是写操作，它会导致其他CPU中对应的缓存行无效。
  >
  > 
  >
  > lock指令：强制将工作内存副本变量值立即写回到主内存，并无效化其他工作内存的副本；
  >
  > ​					实际是在store的时候执行了一次JMM的lock操作，在write结束后执行JMM的unlock

  

  

